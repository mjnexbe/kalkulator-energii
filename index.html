<!DOCTYPE html>
<html lang="pl" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAGAZYNY MOCY | NEXBE Corporate</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;800&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { brandRed: '#E31E24', brandBlack: '#000000', brandWhite: '#FFFFFF' },
                    borderRadius: { 'brand': '12px' }
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .bg-lightning {
            background-color: #ffffff;
            background-image: url("data:image/svg+xml,%3Csvg width='80' height='80' viewBox='0 0 80 80' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M30 0l-10 40h15l-15 40 40-50h-15l15-30z' fill='%20%23e5e7eb' fill-opacity='0.2' fill-rule='evenodd'/%3E%3C/svg%3E");
        }
        .hero-overlay { background: linear-gradient(90deg, rgba(227,30,36,0.9) 0%, rgba(0,0,0,0.4) 100%); }
        .step-hidden { display: none; }
        .input-corporate { @apply w-full bg-gray-50 border-b-2 border-gray-200 p-4 font-bold focus:outline-none focus:border-brandRed transition-colors; }
    </style>
</head>
<body class="bg-brandWhite text-brandBlack">

    <header class="relative h-[60vh] flex items-center overflow-hidden bg-black">
        <img src="https://images.unsplash.com/photo-1586528116311-ad8dd3c8310d?q=80&w=2070" class="absolute inset-0 w-full h-full object-cover opacity-60">
        <div class="absolute inset-0 hero-overlay"></div>
        <div class="container mx-auto px-6 relative z-10 text-white text-center">
            <h1 class="text-5xl font-extrabold uppercase tracking-tighter mb-4">Magazyny Mocy</h1>
            <p class="text-xl font-light opacity-80">Konfiguracja system√≥w Nexbe Corporate</p>
        </div>
    </header>

    <section id="kalkulator" class="py-20">
        <div class="container mx-auto px-6 max-w-5xl">
            <div class="bg-white rounded-brand border border-gray-100 shadow-2xl overflow-hidden">
                <div id="progress-bar" class="bg-brandRed h-1.5 transition-all duration-700" style="width: 33%"></div>

                <div class="p-10 lg:p-16">
                    <div id="step-1">
                        <h2 class="text-2xl font-black uppercase mb-10 text-center">Wybierz typ inwestycji</h2>
                        <div class="grid md:grid-cols-3 gap-6">
                            <div onclick="selectScenario(1, this)" class="scenario-tile cursor-pointer border-2 border-gray-100 rounded-brand p-8 text-center hover:border-brandRed transition-all">
                                <span class="text-3xl block mb-4">üè†</span>
                                <h4 class="font-bold uppercase text-sm">Retrofit AC</h4>
                            </div>
                            <div onclick="selectScenario(2, this)" class="scenario-tile cursor-pointer border-2 border-gray-100 rounded-brand p-8 text-center hover:border-brandRed transition-all">
                                <span class="text-3xl block mb-4">‚òÄÔ∏è</span>
                                <h4 class="font-bold uppercase text-sm">Nowy System</h4>
                            </div>
                            <div onclick="selectScenario(3, this)" class="scenario-tile cursor-pointer border-2 border-gray-100 rounded-brand p-8 text-center hover:border-brandRed transition-all">
                                <span class="text-3xl block mb-4">üîÑ</span>
                                <h4 class="font-bold uppercase text-sm">Modernizacja</h4>
                            </div>
                        </div>
                        <div class="mt-12 text-center">
                            <button onclick="nextStep()" id="btn-next-1" disabled class="bg-gray-200 text-gray-400 font-black py-4 px-12 rounded-brand cursor-not-allowed">DALEJ</button>
                        </div>
                    </div>

                    <div id="step-2" class="step-hidden">
                        <div class="max-w-md mx-auto space-y-8">
                            <div>
                                <label class="text-[10px] font-black uppercase tracking-widest text-brandRed">Moc PV (kWp)</label>
                                <input type="number" id="pv-power" class="input-corporate text-2xl" placeholder="np. 6.5">
                            </div>
                            <div>
                                <label class="text-[10px] font-black uppercase tracking-widest text-brandRed">Pojemno≈õƒá</label>
                                <select id="battery-capacity" class="input-corporate">
                                    <option value="10">10.24 kWh</option>
                                    <option value="15">15.36 kWh</option>
                                    <option value="20">20.48 kWh</option>
                                </select>
                            </div>
                            <div class="flex justify-between pt-6">
                                <button onclick="prevStep()" class="font-bold text-xs uppercase underline">Wstecz</button>
                                <button onclick="nextStep()" class="bg-brandRed text-white font-black py-4 px-10 rounded-brand">Dalej</button>
                            </div>
                        </div>
                    </div>

                    <div id="step-3" class="step-hidden">
                        <div class="max-w-md mx-auto space-y-4">
                            <label class="flex items-center p-5 border rounded-brand cursor-pointer hover:bg-gray-50">
                                <input type="checkbox" id="opt-backup" class="w-5 h-5 accent-brandRed mr-4">
                                <span class="font-bold text-sm uppercase">Zasilanie awaryjne SZR</span>
                            </label>
                            <label class="flex items-center p-5 border rounded-brand cursor-pointer hover:bg-gray-50">
                                <input type="checkbox" id="opt-ems" class="w-5 h-5 accent-brandRed mr-4" checked>
                                <span class="font-bold text-sm uppercase">System EMS Nexbe</span>
                            </label>
                            <button onclick="calculateResults()" class="w-full bg-brandRed text-white font-black py-5 rounded-brand mt-6 shadow-xl shadow-red-200">OBLICZ ROI I KOSZTY</button>
                        </div>
                    </div>

                    <div id="results-section" class="hidden">
                        <div class="grid lg:grid-cols-2 gap-12 border-b border-gray-100 pb-12">
                            <div>
                                <h3 class="text-2xl font-black uppercase mb-6 tracking-tighter">Podsumowanie</h3>
                                <div class="space-y-3 text-sm">
                                    <div class="flex justify-between"><span>Brutto:</span> <span id="res-gross" class="font-bold">0 z≈Ç</span></div>
                                    <div class="flex justify-between text-brandRed font-bold"><span>Dotacje:</span> <span id="res-grant">0 z≈Ç</span></div>
                                    <div class="flex justify-between font-black text-xl pt-4 border-t"><span>NETTO:</span> <span id="res-final" class="text-brandRed">0 z≈Ç</span></div>
                                </div>
                                <div class="mt-8">
                                    <canvas id="roiChart" height="200"></canvas>
                                </div>
                            </div>

                            <div class="bg-gray-50 p-8 rounded-brand">
                                <h3 class="text-lg font-black uppercase mb-4 tracking-tight">Otrzymaj pe≈ÇnƒÖ ofertƒô na e-mail</h3>
                                <form id="contact-form" action="https://formspree.io/f/mojnjgay" method="POST" class="space-y-4">
                                    <input type="hidden" name="Wybrana Pojemno≈õƒá" id="form-cap">
                                    <input type="hidden" name="Koszt Finalny" id="form-price">
                                    <input type="hidden" name="Dotacja" id="form-grant">
                                    
                                    <input type="text" name="Imiƒô i Nazwisko" placeholder="Imiƒô i Nazwisko" required class="input-corporate text-sm">
                                    <input type="email" name="Email" placeholder="Tw√≥j adres e-mail" required class="input-corporate text-sm">
                                    <input type="tel" name="Telefon" placeholder="Numer telefonu" required class="input-corporate text-sm">
                                    <textarea name="Wiadomo≈õƒá" placeholder="Miejsce monta≈ºu / Dodatkowe pytania" class="input-corporate text-sm h-24"></textarea>
                                    
                                    <button type="submit" class="w-full bg-brandBlack text-white font-black py-4 rounded-brand hover:bg-brandRed transition-colors">WY≈öLIJ ZAPYTANIE</button>
                                    <p class="text-[9px] text-gray-400 mt-4 uppercase">KlikajƒÖc przycisk wyra≈ºasz zgodƒô na kontakt w celu przedstawienia oferty Nexbe.</p>
                                </form>
                                <div id="form-success" class="hidden text-center p-4 bg-green-100 text-green-700 font-bold rounded-brand">
                                    Dziƒôkujemy! Twoje zapytanie zosta≈Ço wys≈Çane.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <script>
        let currentStep = 1;
        let selectedScenario = 0;
        let myChart = null;
        const PRICES = { battery_10: 28000, battery_15: 38000, battery_20: 48000, retrofit: 5500, hybrid: 8500, pv: 4600, backup: 3000, ems: 1800 };

        function selectScenario(id, el) {
            selectedScenario = id;
            document.querySelectorAll('.scenario-tile').forEach(t => t.classList.remove('border-brandRed', 'bg-red-50'));
            el.classList.add('border-brandRed', 'bg-red-50');
            const b = document.getElementById('btn-next-1');
            b.removeAttribute('disabled');
            b.className = "bg-brandRed text-white font-black py-4 px-12 rounded-brand hover:scale-105 transition-all";
        }

        function nextStep() {
            document.getElementById(`step-${currentStep}`).classList.add('step-hidden');
            currentStep++;
            document.getElementById(`step-${currentStep}`).classList.remove('step-hidden');
            document.getElementById('progress-bar').style.width = (currentStep/3)*100 + '%';
        }

        function prevStep() {
            document.getElementById(`step-${currentStep}`).classList.add('step-hidden');
            currentStep--;
            document.getElementById(`step-${currentStep}`).classList.remove('step-hidden');
            document.getElementById('progress-bar').style.width = (currentStep/3)*100 + '%';
        }

        function calculateResults() {
            const pv = parseFloat(document.getElementById('pv-power').value) || 0;
            const cap = document.getElementById('battery-capacity').value;
            let gross = PRICES['battery_'+cap];
            if(selectedScenario===1) gross += PRICES.retrofit;
            if(selectedScenario===2) gross += (pv * PRICES.pv) + PRICES.hybrid;
            if(selectedScenario===3) gross += PRICES.hybrid + 3000;
            if(document.getElementById('opt-backup').checked) gross += PRICES.backup;
            if(document.getElementById('opt-ems').checked) gross += PRICES.ems;

            let grant = (parseInt(cap) >= 9) ? 16000 : 0;
            let final = gross - grant - ((gross-grant)*0.12);

            // Wy≈õwietlanie
            document.getElementById('res-gross').innerText = fmt(gross);
            document.getElementById('res-grant').innerText = "- " + fmt(grant);
            document.getElementById('res-final').innerText = fmt(final);

            // PRZEKAZANIE DANYCH DO UKRYTYCH P√ìL FORMULARZA
            document.getElementById('form-cap').value = cap + " kWh";
            document.getElementById('form-price').value = fmt(final);
            document.getElementById('form-grant').value = fmt(grant);

            document.getElementById('step-3').classList.add('step-hidden');
            document.getElementById('results-section').classList.remove('hidden');
            document.getElementById('progress-bar').style.width = '100%';
            renderChart(final);
        }

        function fmt(n) { return new Intl.NumberFormat('pl-PL', { style: 'currency', currency: 'PLN', maximumFractionDigits: 0 }).format(n); }

        function renderChart(invest) {
            const ctx = document.getElementById('roiChart').getContext('2d');
            if(myChart) myChart.destroy();
            myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Start', '5 lat', '10 lat', '15 lat'],
                    datasets: [
                        { label: 'Oszczƒôdno≈õƒá', data: [invest, invest*0.6, invest*0.2, 0], borderColor: '#E31E24', fill: true, backgroundColor: 'rgba(227,30,36,0.1)', tension: 0.3 }
                    ]
                },
                options: { plugins: { legend: { display: false } }, scales: { y: { display: false } } }
            });
        }

        // Obs≈Çuga wysy≈Çki bez prze≈Çadowania strony
        const form = document.getElementById('contact-form');
        form.onsubmit = async (e) => {
            e.preventDefault();
            const data = new FormData(form);
            const response = await fetch(form.action, { method: 'POST', body: data, headers: { 'Accept': 'application/json' } });
            if (response.ok) {
                form.classList.add('hidden');
                document.getElementById('form-success').classList.remove('hidden');
            }
        };
    </script>
</body>
</html>
